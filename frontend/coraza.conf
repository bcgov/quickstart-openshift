# Coraza WAF Configuration
# Basic WAF configuration with OWASP Core Rule Set

# Enable rules engine
SecRuleEngine On

# Request body handling
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072

# Response body handling
SecResponseBodyAccess On
SecResponseBodyMimeType text/plain text/html text/xml application/json
SecResponseBodyLimit 524288

# File upload handling
SecTmpDir /tmp/
SecDataDir /tmp/

# Logging
SecAuditEngine RelevantOnly
SecAuditLogParts ABIJDEFHZ
SecAuditLogType Serial
SecAuditLog /dev/stdout

# Debug log
SecDebugLog /dev/stdout
SecDebugLogLevel 0

# Generic attack detection
SecRule REQUEST_HEADERS|ARGS|ARGS_NAMES "@detectSQLi" \
    "id:1001,phase:2,block,log,msg:'SQL Injection Attack Detected'"

SecRule REQUEST_HEADERS|ARGS|ARGS_NAMES "@detectXSS" \
    "id:1002,phase:2,block,log,msg:'XSS Attack Detected'"

# Additional protection rules
SecRule REQUEST_HEADERS:User-Agent "@pmFromFile /etc/caddy/rules/scanners-user-agents.data" \
    "id:1003,phase:1,deny,log,msg:'Known Security Scanner Detected'"

SecRule REQUEST_URI "@contains /admin" \
    "id:1004,phase:1,pass,log,msg:'Admin area access attempt'"

# Common attack patterns
SecRule ARGS "@rx <script" \
    "id:1005,phase:2,block,log,msg:'Potential XSS in Arguments'"

SecRule ARGS "@rx (?i)(union|select|insert|update|delete|drop|create|alter).*\(" \
    "id:1006,phase:2,block,log,msg:'SQL Injection Pattern Detected'"
